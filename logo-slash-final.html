<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ゼゼヒヒ - 最終版 完璧な斬撃アニメーション</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght=900&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            font-family: 'Zen Kaku Gothic New', sans-serif;
        }

        .logo-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #logoSVG {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
        }

        .logo-text {
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-weight: 900;
            font-size: 120px;
            fill: #ffffff;
            user-select: none;
        }

        .instruction {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-family: sans-serif;
            z-index: 100;
            animation: fadeInOut 8s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .debug-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            font-family: monospace;
            display: none;
        }
    </style>
</head>
<body>
    <div class="instruction">
        最終版：緩やかな角度 + 完全通り抜け | クリックで再生
    </div>

    <div class="logo-container">
        <svg id="logoSVG" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
            <!-- ====================================== -->
            <!-- 定義：フィルター、グラデーション、クリップパス -->
            <!-- ====================================== -->
            <defs>
                <!-- 気円斬用の強烈な発光フィルター -->
                <filter id="kienzan-glow">
                    <feGaussianBlur stdDeviation="6" result="coloredBlur" />
                    <feMerge>
                        <feMergeNode in="coloredBlur" />
                        <feMergeNode in="coloredBlur" />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>

                <!-- 衝撃波用の放射状グラデーション -->
                <radialGradient id="shockwaveGradient">
                    <stop offset="0%" stop-color="#ffffff" stop-opacity="0.8" />
                    <stop offset="50%" stop-color="#87CEEB" stop-opacity="0.5" />
                    <stop offset="100%" stop-color="#00BFFF" stop-opacity="0" />
                </radialGradient>

                <!--
                ====================================
                角度調整パラメータ（Angle Parameters）
                ====================================
                【重要】この値を変更すると、斬撃の角度が変わります

                斬撃ラインの方程式（より緩やかな角度）:
                - 始点: (200, 50)   ← 画面左上の外側から開始
                - 終点: (1000, 317) ← 画面右下の外側まで突き抜ける
                - 傾き: (317-50)/(1000-200) = 267/800 = 1/3（緩やか）
                - 方程式: y = (1/3)x - 16.67

                ※傾きを小さくするほど、より水平に近い斬撃になります
                ※現在の傾き 1/3 は、前回の 2/3 の半分（より緩やか）
                ====================================
                -->

                <!--
                ====================================
                切断ライン座標計算（Complete Through-Pass）
                ====================================
                文字の位置での切断ラインY座標:
                方程式 y = (1/3)x - 16.67 を使用

                ヒヒ1（x=400-600の範囲）:
                  x=400: y = (1/3)*400 - 16.67 = 116.67
                  x=600: y = (1/3)*600 - 16.67 = 183.33

                ヒヒ2（x=560-780の範囲）:
                  x=560: y = (1/3)*560 - 16.67 = 170
                  x=780: y = (1/3)*780 - 16.67 = 243.33

                衝撃波中心（x=500）:
                  y = (1/3)*500 - 16.67 = 150
                ====================================
                -->

                <!-- ヒヒ1（1文字目）上半分 - 緩やかな斜め切断ライン上部 -->
                <clipPath id="hihi1TopClip">
                    <!-- 方程式 y = (1/3)x - 16.67 に従う -->
                    <polygon points="400,80 600,80 600,183 400,117" />
                </clipPath>

                <!-- ヒヒ1（1文字目）下半分 - 緩やかな斜め切断ライン下部 -->
                <clipPath id="hihi1BottomClip">
                    <!-- 方程式 y = (1/3)x - 16.67 に従う -->
                    <polygon points="400,117 600,183 600,380 400,380" />
                </clipPath>

                <!-- ヒヒ2（2文字目）上半分 - 緩やかな斜め切断ライン上部 -->
                <clipPath id="hihi2TopClip">
                    <!-- 方程式 y = (1/3)x - 16.67 に従う -->
                    <polygon points="560,80 780,80 780,243 560,170" />
                </clipPath>

                <!-- ヒヒ2（2文字目）下半分 - 緩やかな斜め切断ライン下部 -->
                <clipPath id="hihi2BottomClip">
                    <!-- 方程式 y = (1/3)x - 16.67 に従う -->
                    <polygon points="560,170 780,243 780,380 560,380" />
                </clipPath>
            </defs>

            <!-- ====================================== -->
            <!-- ゼゼ部分 -->
            <!-- ====================================== -->
            <text class="logo-text" x="50" y="280">ゼ</text>
            <text class="logo-text" x="210" y="280">ゼ</text>

            <!-- ====================================== -->
            <!-- ヒヒ部分 - 完全版 -->
            <!-- ====================================== -->
            <g id="hihi1Full">
                <text class="logo-text" x="400" y="280">ヒ</text>
            </g>

            <g id="hihi2Full">
                <text class="logo-text" x="560" y="280">ヒ</text>
            </g>

            <!-- ====================================== -->
            <!-- ヒヒ部分 - 分割版 -->
            <!-- ====================================== -->
            <g id="hihi1Top" clip-path="url(#hihi1TopClip)" opacity="0">
                <text class="logo-text" x="400" y="280">ヒ</text>
            </g>

            <g id="hihi1Bottom" clip-path="url(#hihi1BottomClip)" opacity="0">
                <text class="logo-text" x="400" y="280">ヒ</text>
            </g>

            <g id="hihi2Top" clip-path="url(#hihi2TopClip)" opacity="0">
                <text class="logo-text" x="560" y="280">ヒ</text>
            </g>

            <g id="hihi2Bottom" clip-path="url(#hihi2BottomClip)" opacity="0">
                <text class="logo-text" x="560" y="280">ヒ</text>
            </g>

            <!-- ====================================== -->
            <!-- VFX: 気円斬（Kienzan）- 超高密度エネルギーブレード -->
            <!-- 座標: 画面外から画面外へ完全通り抜け -->
            <!-- 始点: (200, 50) ← 左上外側 -->
            <!-- 終点: (1000, 317) ← 右下外側（viewBox外） -->
            <!-- ====================================== -->
            <g id="kienzan" opacity="0">
                <!-- 外側の黄色の輝き（残像効果） -->
                <line
                    x1="200" y1="50"
                    x2="1000" y2="317"
                    stroke="#FFD700"
                    stroke-width="12"
                    stroke-linecap="round"
                    opacity="0.3"
                    filter="url(#kienzan-glow)"
                    style="filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)) drop-shadow(0 0 40px rgba(255, 215, 0, 0.5));"
                />

                <!-- 中間層の青白い光 -->
                <line
                    x1="200" y1="50"
                    x2="1000" y2="317"
                    stroke="#87CEEB"
                    stroke-width="6"
                    stroke-linecap="round"
                    opacity="0.6"
                    filter="url(#kienzan-glow)"
                    style="filter: drop-shadow(0 0 15px rgba(135, 206, 235, 0.9)) drop-shadow(0 0 30px rgba(135, 206, 235, 0.6));"
                />

                <!-- コアの鋭い白い刃（最も強烈） -->
                <line
                    x1="200" y1="50"
                    x2="1000" y2="317"
                    stroke="#FFFFFF"
                    stroke-width="3"
                    stroke-linecap="round"
                    opacity="1"
                    filter="url(#kienzan-glow)"
                    style="filter: drop-shadow(0 0 12px rgba(255, 255, 255, 1)) drop-shadow(0 0 25px rgba(255, 255, 255, 0.8)) drop-shadow(0 0 40px rgba(255, 255, 255, 0.5));"
                />

                <!-- 最も内側のシャープなエッジ -->
                <line
                    x1="200" y1="50"
                    x2="1000" y2="317"
                    stroke="#FFFFFF"
                    stroke-width="1"
                    stroke-linecap="round"
                    opacity="1"
                    style="filter: drop-shadow(0 0 8px rgba(255, 255, 255, 1));"
                />
            </g>

            <!-- ====================================== -->
            <!-- VFX: インパクト衝撃波 -->
            <!-- 中心座標: 斬撃が文字の中央を通過する位置 -->
            <!-- x=500, y = (1/3)*500 - 16.67 = 150 -->
            <!-- ====================================== -->
            <g id="impactWaves">
                <circle class="shockwave" cx="500" cy="150" r="0" fill="none" stroke="url(#shockwaveGradient)" stroke-width="8" opacity="0" />
                <circle class="shockwave" cx="500" cy="150" r="0" fill="none" stroke="url(#shockwaveGradient)" stroke-width="6" opacity="0" />
                <circle class="shockwave" cx="500" cy="150" r="0" fill="none" stroke="url(#shockwaveGradient)" stroke-width="4" opacity="0" />
                <circle class="shockwave" cx="500" cy="150" r="0" fill="none" stroke="url(#shockwaveGradient)" stroke-width="3" opacity="0" />
            </g>

            <!-- ====================================== -->
            <!-- 下部のZEZEHIHIテキスト -->
            <!-- ====================================== -->
            <text
                id="bottomText"
                x="400"
                y="370"
                font-size="32"
                font-weight="600"
                fill="white"
                font-family="'Playfair Display', serif"
                text-anchor="middle"
                letter-spacing="0.2em"
                opacity="1"
            >
                ZEZEHIHI
            </text>
        </svg>
    </div>

    <div class="debug-info" id="debugInfo">
        Animation: Ready
    </div>

    <!-- ====================================== -->
    <!-- GSAP Core ライブラリ -->
    <!-- ====================================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <script>
        // ==========================================
        // DOM要素の取得
        // ==========================================
        const hihi1Full = document.getElementById('hihi1Full');
        const hihi2Full = document.getElementById('hihi2Full');
        const hihi1Top = document.getElementById('hihi1Top');
        const hihi1Bottom = document.getElementById('hihi1Bottom');
        const hihi2Top = document.getElementById('hihi2Top');
        const hihi2Bottom = document.getElementById('hihi2Bottom');
        const kienzan = document.getElementById('kienzan');
        const impactWaves = document.getElementById('impactWaves');
        const shockwaves = document.querySelectorAll('.shockwave');
        const debugInfo = document.getElementById('debugInfo');

        // ==========================================
        // デバッグ用関数
        // ==========================================
        function debug(message) {
            if (debugInfo) {
                debugInfo.textContent = message;
                console.log(message);
            }
        }

        // ==========================================
        // パフォーマンス最適化設定
        // ==========================================
        gsap.config({
            force3D: true,
        });

        // GPU最適化のため、transform-originを設定
        gsap.set([hihi1Top, hihi2Top, hihi1Bottom, hihi2Bottom], {
            transformOrigin: "center center",
            force3D: true,
        });

        gsap.set(kienzan, {
            transformOrigin: "center center",
            force3D: true,
        });

        // ==========================================
        // メインアニメーション関数
        // ==========================================
        function createFinalKienzanAnimation() {
            const masterTL = gsap.timeline({
                repeat: -1,
                repeatDelay: 2.5,
                onStart: () => debug('Animation: Started'),
                onRepeat: () => debug('Animation: Loop')
            });

            // 少し待つ
            masterTL.to({}, { duration: 0.8 });

            // ==========================================
            // フェーズ1: 気円斬（Kienzan）- 完全通り抜け
            // ==========================================

            // 気円斬が出現し、弾丸のように突き抜ける
            masterTL.to(kienzan, {
                opacity: 1,
                duration: 0.02,
                ease: "power4.out",
                onStart: () => debug('Kienzan: Energy blade appears!')
            });

            //
            // 完全通り抜け（Complete Through-Pass）
            // 画面左上外側から右下外側まで完全に突き抜ける
            // 移動距離: x=800, y=267 (1000-200=800, 317-50=267)
            // フェードアウトせずに、高速で画面外へ飛び去る
            //
            masterTL.to(kienzan, {
                x: 800,   // 右下の外側まで（viewBox外）
                y: 267,   // 傾き1/3に従った移動
                duration: 0.1,
                ease: "power1.in",
                onStart: () => debug('Kienzan: Complete through-pass!')
            }, "-=0.02");

            // 画面外に飛び去った後、瞬時に消える（フェードではなく瞬時）
            masterTL.to(kienzan, {
                opacity: 0,
                duration: 0.02,
                ease: "power1.out",
            }, "+=0.05");

            // ==========================================
            // タイミングの短縮（Tighter Timing）- 維持
            // 斬撃が文字の中央を通過した瞬間に切断が発生
            // "-=0.06" で食い気味に反応させる
            // ==========================================

            // 完全版のヒヒを非表示にする（斬撃の中盤で即座に）
            masterTL.to([hihi1Full, hihi2Full], {
                opacity: 0,
                duration: 0.01,
                onStart: () => debug('Split: Instant cut!')
            }, '-=0.11');  // 調整（0.1秒の移動中の中盤）

            // 分割版を表示（同時）
            masterTL.to([hihi1Top, hihi1Bottom, hihi2Top, hihi2Bottom], {
                opacity: 1,
                duration: 0.01,
            }, '-=0.01');

            // ==========================================
            // 衝撃波（斬撃と同時多発的に）- 維持
            // ==========================================
            masterTL.to(shockwaves, {
                attr: { r: (i) => 80 + (i * 40) },
                opacity: 0.7,
                duration: 0.35,
                stagger: 0.06,
                ease: "power2.out",
                onStart: () => debug('Impact: Shockwave!')
            }, '-=0.13');  // 斬撃とほぼ同時

            masterTL.to(shockwaves, {
                opacity: 0,
                duration: 0.25,
                stagger: 0.06,
                ease: "power2.in",
            }, '-=0.15');

            // ==========================================
            // 物理挙動（切断と同時に即座に開始）- 維持
            // ==========================================

            // ----------------------------------------------
            // 【下半分】激しい振動（切断の瞬間から即座に）
            // ----------------------------------------------
            const vibrationTL = gsap.timeline();

            vibrationTL.to([hihi1Bottom, hihi2Bottom], {
                x: 3,
                y: -2,
                duration: 0.04,
                ease: "power2.out",
                onStart: () => debug('Bottom: Instant vibration!')
            })
            .to([hihi1Bottom, hihi2Bottom], {
                x: -3,
                y: 2,
                duration: 0.04,
                ease: "power2.inOut",
            })
            .to([hihi1Bottom, hihi2Bottom], {
                x: 2,
                y: -1,
                duration: 0.04,
                ease: "power2.inOut",
            })
            .to([hihi1Bottom, hihi2Bottom], {
                x: -2,
                y: 1,
                duration: 0.04,
                ease: "power2.inOut",
            })
            .to([hihi1Bottom, hihi2Bottom], {
                x: 1,
                y: -0.5,
                duration: 0.04,
                ease: "power2.inOut",
            })
            .to([hihi1Bottom, hihi2Bottom], {
                x: -1,
                y: 0.5,
                duration: 0.04,
                ease: "power2.inOut",
            })
            .to([hihi1Bottom, hihi2Bottom], {
                x: 0,
                y: 0,
                duration: 0.08,
                ease: "elastic.out(2, 0.3)",
            });

            // 振動を切断と同時に開始（"-=0.13"で食い気味）
            masterTL.add(vibrationTL, '-=0.13');

            // ----------------------------------------------
            // 【上半分】重力による落下（切断と同時に即座に）
            // ----------------------------------------------
            masterTL.to([hihi1Top, hihi2Top], {
                y: 60,
                x: 15,
                rotation: 8,
                opacity: 0.8,
                duration: 0.8,
                ease: "power2.in",
                onStart: () => debug('Top: Instant fall!')
            }, '-=0.13');  // 振動と同時に落下開始

            // ==========================================
            // フェーズ4: 待機時間
            // ==========================================
            masterTL.to({}, { duration: 1.2 });

            // ==========================================
            // フェーズ5: 復元（Restore）- 維持
            // ==========================================

            // 上半分が磁力で吸い寄せられるように元に戻る
            masterTL.to([hihi1Top, hihi2Top], {
                y: 0,
                x: 0,
                rotation: 0,
                opacity: 1,
                duration: 0.9,
                ease: "back.out(1.7)",
                onStart: () => debug('Restore: Magnetic pull!')
            });

            // 下半分も完全に静止
            masterTL.to([hihi1Bottom, hihi2Bottom], {
                x: 0,
                y: 0,
                duration: 0.9,
                ease: "back.out(1.7)",
            }, '-=0.9');

            // 分割版を非表示
            masterTL.to([hihi1Top, hihi1Bottom, hihi2Top, hihi2Bottom], {
                opacity: 0,
                duration: 0.2,
            }, '-=0.2');

            // 完全版を再表示
            masterTL.to([hihi1Full, hihi2Full], {
                opacity: 1,
                duration: 0.2,
            }, '-=0.2');

            // 気円斬をリセット
            masterTL.set(kienzan, {
                x: 0,
                y: 0,
                opacity: 0,
            });

            // 衝撃波をリセット
            masterTL.set(shockwaves, {
                attr: { r: 0 },
                opacity: 0,
            });

            return masterTL;
        }

        // ==========================================
        // アニメーション実行
        // ==========================================
        let mainAnimation;

        // ページロード時に自動開始
        window.addEventListener('load', () => {
            setTimeout(() => {
                mainAnimation = createFinalKienzanAnimation();
                mainAnimation.play();
                debug('Animation: Auto-started');
            }, 500);
        });

        // クリックで手動再生
        document.querySelector('.logo-container').addEventListener('click', () => {
            if (mainAnimation) {
                mainAnimation.restart();
                debug('Animation: Manual restart');
            }
        });

        // ==========================================
        // レスポンシブ対応
        // ==========================================
        window.addEventListener('resize', () => {
            debug('Window: Resized');
        });
    </script>
</body>
</html>